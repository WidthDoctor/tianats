import "./BigSize.css";
import { useState, useEffect } from "react";

interface ImageGroup {
  [key: number]: string[];
}

function BigSize() {
  const [images, setImages] = useState<ImageGroup>({
    0: [],
    1: [],
    2: [],
    3: [],
  });

  useEffect(() => {
    const loadImages = async () => {
      try {
        // Динамически загружаем все изображения из папки с ленивой загрузкой
        const imageModules = import.meta.glob<{ default: string }>(
          "../../assets/bigSizesPageImages/*.{jpg,jpeg,png,webp}",
          { eager: false }, // Лениво загружаем для улучшения производительности
        );

        // Извлекаем пути изображений (они загружаются по требованию)
        const imagePaths = await Promise.all(
          Object.values(imageModules).map(async (loader) => {
            const module = await loader();
            return module.default;
          }),
        );

        // Проверка: есть ли достаточно изображений
        if (imagePaths.length < 16) {
          console.warn(
            `⚠️ Найдено ${imagePaths.length} изображений, но нужно 16. Некоторые изображения повторятся.`,
          );
        }

        // Fisher-Yates shuffle для правильного перемешивания массива
        const shuffled = [...imagePaths]; // Копируем массив
        for (let i = shuffled.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }

        // Разделяем на 4 группы по 4 изображения каждый
        // Если изображений меньше 16, некоторые будут повторены, но в разных группах
        const imageGroups: ImageGroup = {
          0: shuffled.slice(0, 4),
          1: shuffled.slice(4, 8),
          2: shuffled.slice(8, 12),
          3: shuffled.slice(12, 16),
        };

        setImages(imageGroups);
      } catch (error) {
        console.error("Ошибка загрузки изображений:", error);
      }
    };

    loadImages();
  }, []);

  // Функция для рендеринга коллекции изображений
  const renderImageGroup = (groupIndex: number) => {
    return images[groupIndex]?.map((imagePath, idx) => (
      <img
        key={`${groupIndex}-${idx}`}
        src={imagePath}
        alt={`Big size dress ${groupIndex * 4 + idx + 1}`}
        loading="lazy" // Ленивая загрузка - изображения загружаются при приближении к viewport
        decoding="async" // Асинхронное декодирование для улучшения производительности
        style={{
          width: "100%",
          height: "auto",
          borderRadius: "4px",
          objectFit: "cover",
        }}
      />
    ));
  };

  return (
    <>
      <main className="big-size">
        <section className="big-size__intro">
          <h2 id="big-size__title">Большие размеры</h2>
          <h3>Выбираем свадебное платье для невесты с полной фигурой</h3>
          <div className="big-size__imagesFirst">{renderImageGroup(0)}</div>
          <div className="big-size__description">
            <p>
              Первое, что хотелось бы отметить - не называйте свою фигуру
              нестандартной! Это самое распространенное заблуждение, что если у
              человека пышные формы или широкая комплекция, то он не такой как
              все. Стандартных фигур вообще не существует! Именно для этого и
              существует индивидуальный пошив. Потому что нет двух одинаковых
              людей как и двух одинаковых снежинок или листьев на дереве. Каждый
              уникальный в своей красоте. А то, что производства шьют на
              усредненные размеры - это другой разговор. ГОСТы НИКОМУ не
              подходят. Всегда с чем-то приходится мириться в большей или
              меньшей степени. Это ни кому не секрет.
            </p>
          </div>
          <div className="big-size__imagesSecond">{renderImageGroup(1)}</div>
        </section>
        <section className="big-size__type">
          <h3>Ваша форма и тип фигуры</h3>
          <p>
            В первую очередь Вам необходимо определиться с Вашим размером и
            фигурой. С этой информацией Вам будет куда проще найти платье,
            которое сможет подчеркнуть Вашу красоту.
          </p>
          <p>
            Например, трапециевидные платья лучше всего подойдут полным девушкам
            с крупными бедрами. А выразительное декольте поможет акцентировать
            внимание на верхней части тела.
          </p>
          <p>
            Есть такое негласное правило, что нужно избегать пышных юбок, чтобы
            не выглядеть в них более полной, чем на самом деле. Лично я с этим
            не соглашусь. Это так же индивидуально, как и все остальное.
            Практика доказывает.
          </p>
          <p>
            V-образный вырез идеально подойдет невесте с пышной грудью. Однако
            нужно быть аккуратными при выборе такого выреза и сочетания его с
            видом ткани, чтобы не получился эффект халата.
          </p>
          <p>
            Платье А-образной формы с неакцентированной талией может придать
            Вашим формам немного длины, чем скорректирует Ваши пропорции.
          </p>
          <p>
            Если Вашу фигуру можно условно назвать перевернутым треугольником,
            т.е. у Вас пышная грудь и полноватые руки, то на лифе Вашего
            свадебного платья должно быть минимум декоративных отделок. Учитывая
            объем груди рекомендуется глубокий вырез с учетом овала лица.
            Никакого акцента на талию. Очень хорошо будет выглядеть платье с
            завышенной линией талии, что выгодно подчеркнет Вашу грудь.
          </p>
          <p>
            Полноватые руки можно прикрыть кружевной или фатиновой накидкой.
            Также полные руки помогут красиво оформить рукава - вариантовм кроя
            и использования материалов множество.
          </p>
          <div className="big-size__imagesThird">{renderImageGroup(2)}</div>
        </section>
        <section className="fabric">
          <h3>Ткани</h3>
          <p>
            Выбирайте легкие ткани, которые не добавят Вам лишнего объема и не
            будут смотреться слишком массивно. Очень выгодно можно использовать
            кружева и гипюр, комбинируя фрагменты с основной тканью и открывая
            рукава и плечи под кружевом, что визуально сильно уменьшает их
            объем.
          </p>
          <p>
            Главное, что следует учесть при заказе платья на полную фигуру, Вы
            должны шить напрямую у портного, имеющего опыт пошива больших
            размеров. Это нужно уточнить заранее. Я располагаю таким опытом.
          </p>
          <div className="big-size__imagesFourth">{renderImageGroup(3)}</div>
          <p>
            Для удобства выбора приглашаю Вас просмотреть специально подобранную
            галерею фотографий с моделями больших размеров.
          </p>
          <p>
            Что особенно радует меня в этом году, так это то, что модельеры
            наконец-то стали шить и показывать на подиумах платья больших
            размеров, выполненных очень легкими, немассивными, нетяжелыми
            визуально. Часто это те же модели что и в основной коллекции.
          </p>
        </section>
      </main>
    </>
  );
}
export default BigSize;
